/**
 * –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ "üìä –ü—Ä–æ–µ–∫—Ç—ã" - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
 */

import { Telegraf, session } from "telegraf";
import dotenv from "dotenv";
import { NeonAdapter } from "../src/adapters/neon-adapter";
import { setupInstagramScraperBot } from "../index";
import type { ScraperBotContext } from "../src/types";

// –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
dotenv.config();

async function testProjectsButtonFixes() {
  console.log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–Ω–æ–ø–∫–∏ "üìä –ü—Ä–æ–µ–∫—Ç—ã"...');

  const token = process.env.BOT_TOKEN;
  if (!token) {
    console.error("‚ùå –û—à–∏–±–∫–∞: BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω");
    process.exit(1);
  }

  try {
    // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞
    const bot = new Telegraf<ScraperBotContext>(token);
    bot.use(session());

    // –°–æ–∑–¥–∞–µ–º –∞–¥–∞–ø—Ç–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
    const storageAdapter = new NeonAdapter();
    await storageAdapter.initialize();

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –±–æ—Ç–∞
    setupInstagramScraperBot(
      bot,
      storageAdapter as any, // –í—Ä–µ–º–µ–Ω–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      {
        telegramBotToken: token,
      }
    );

    console.log("‚úÖ –ë–æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω —É—Å–ø–µ—à–Ω–æ");

    // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
    console.log("\nüé® –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:");

    // –¢–µ—Å—Ç 1: –°–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ –ø—Ä–æ–µ–∫—Ç–æ–≤
    const emptyMessage =
      "*–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏*\n\n–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤\\. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã\\!";
    console.log("üìù –°–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ –ø—Ä–æ–µ–∫—Ç–æ–≤ (MarkdownV2):");
    console.log(emptyMessage);

    // –¢–µ—Å—Ç 2: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏
    const projectsMessage = "*–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏*\n\n–í–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã \\(2\\):";
    console.log("\nüìù –°–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏ (MarkdownV2):");
    console.log(projectsMessage);

    // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ wizard —Å–æ—Å—Ç–æ—è–Ω–∏–π
    console.log("\nüîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ wizard —Å–æ—Å—Ç–æ—è–Ω–∏–π:");
    console.log("‚úÖ –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —à–∞–≥—É 2 (–º–µ–Ω—é –ø—Ä–æ–µ–∫—Ç–∞)");
    console.log(
      "‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–ª—è –æ—à–∏–±–∫–∏ '–Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç'"
    );
    console.log("‚úÖ –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É scenes");

    await storageAdapter.close();
    console.log("\n‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!");

    console.log("\nüìã –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:");
    console.log("1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ (MarkdownV2)");
    console.log("2. ‚úÖ –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π '–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤'");
    console.log("3. ‚úÖ –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏–º —Å—Ä–∞–∑—É –∫ –º–µ–Ω—é –ø—Ä–æ–µ–∫—Ç–∞");
    console.log("4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–ª—è –æ—à–∏–±–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞");
  } catch (error) {
    console.error("‚ùå –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–µ:", error);
    process.exit(1);
  }
}

testProjectsButtonFixes();
